<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/css/index.css}">
    <title>myCommunity</title>
    <style>
		.note-editable { 
			background-color: white !important;
		}
    </style>
    <script type="text/javascript" th:inline="javascript">
    	/*<![CDATA[*/
    		const scroll = /*[[ ${msgm} ]]*/[]; //msgmÍ∞íÏù¥ ÏóÜÏúºÎ©¥ '[]'Ïù¥Í±∞Í∞íÏù¥ÏÇ¨Ïö©Îê®
    
    		var comm = "#"+/*[[ ${commId} ]]*/"scr";
    		if(scroll != null) {
    			$(document).ready(function () {
					$('html, body').animate({
						scrollTop: $(comm).offset().top - $(comm).height() / 2
					}, 'slow');
					return false;
				});
    		}
    	/*]]>*/
    </script>
</head>
<body>
    <th:block th:replace="fragments/header :: header"></th:block>
    
    <div class="container mt-5">
  		<div class="p-5 rounded">
    		<div class="text-center">
      			<h1 style="display: inline;"><strong>[[ ${board.title} ]]</strong></h1>
      			<th:block th:if="${board.hits} &gt;= 100">	        	
	                <span class="badge rounded-pill bg-danger" style="display:inline;"><small>Hot</small></span>
	            </th:block> 
	            <br>
    		</div>
    		<div class="text-end">
				<i data-feather="eye"></i>&nbsp;[[ ${board.hits} ]]
	            &nbsp;&nbsp;    						
		        <i data-feather="message-circle"></i>&nbsp;[[ ${board.commentsCnt} ]]
		        <th:block th:if="${session.user == null}">
		        	&nbsp;&nbsp;
		        </th:block>
		        <th:block th:if="${session.user != null}">
    				<th:block th:if="${!#strings.equals(board.division, 'Í≥µÏßÄÏÇ¨Ìï≠')}">
    					<th:block th:if="${bookmark != null}">
		    				<div class="text-end" style="display:inline">
		    					<button class="btn btn-lg" style="border:none;" id="bm" type="button" data-bs-toggle="modal" data-bs-target="#myM"> üåù </button>
		    				</div>
    					</th:block>
    				<th:block th:unless="${bookmark != null}">
    				<div class="text-end" style="display:inline">
		    			<button class="btn btn-lg" style="border:none;" id="bm" type="button" data-bs-toggle="modal" data-bs-target="#myM"> üåö </button>
		    		</div>
    			</th:block>

    	
	    		<script  type="text/javascript" th:inline="javascript">
    				/*<![CDATA[*/
      				$('#bm').click(function(){
						var userId = /*[[ ${session.user.id} ]]*/0;;
						var boardId = /*[[ ${board.id} ]]*/0;;
        		
        				$.ajax({
            				url: "/users/bookMark",
            				type: "post",
            				data: {'userId': userId, 'boardId': boardId},
            				success: function(result){
                				if(result == 1) {
									$('#bm').html('üåù');
									$("#mColor").attr("class", "modal-header text-bg-primary");  
									$('#mcon').html("Ï¶êÍ≤®Ï∞æÍ∏∞ Î™©Î°ùÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.");
								}else {
									$('#bm').html('üåö');	
									$("#mColor").attr("class", "modal-header text-bg-warning");  
									$('#mcon').html("Ï¶êÍ≤®Ï∞æÍ∏∞ Î™©Î°ùÏóêÏÑú ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.");
								}
           					},
            				error: function(){
                				alert("Ï¶êÍ≤®Ï∞æÍ∏∞Ïóê Îì±Î°ùÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.");
            				}
        				});
    				});
      				/*]]>*/
    			</script>
    		</th:block>
    		</th:block>
    		</div>
    		 
        	
    		<div class="d-flex justify-content-center">
      			<div class="container">
					<div class="mt-3 mb-3 text-end">
            			<p>
                			<th:block th:if="${board.modifyTime} == null">
                    			[[ ${board.createTime} ]]
                    		</th:block>
                    		<th:block th:if="${board.modifyTime} != null">
                    			[[ ${board.modifyTime} ]](ÏàòÏ†ï)
                   	 		</th:block>
                    		&nbsp;„Éª&nbsp;
                    		<a style="text-decoration: none; color: black;" data-bs-toggle="tooltip" title="ÏûëÏÑ± Í∏Ä Î≥¥Îü¨Í∞ÄÍ∏∞" th:href="@{/boards/name/{nickName}(nickName = ${board.userNickName})}">
	                			<b>[[${board.userNickName}]]</b>
	            			</a>
            			</p>
        			</div>
        			<div class="mb-3">
          				<br><br>
          				<textarea id="summernote" style="width: 100%;">[[ ${board.contents} ]]</textarea>       
          				<br><br>    
        			</div>
        			<div class="text-center">
          				<th:block th:if="${session.user != null}">
            				<th:block th:if="${#strings.equals(session.user.nickName, board.userNickName)} or ${session.user.auth == 1}">                
              					<a th:href="@{/boards/{division}/{id}/edit(division = ${enDivision}, id = ${board.id})}" class="btn btn-primary">
                					ÏàòÏ†ïÌïòÍ∏∞
              					</a>
            				</th:block>
          				</th:block>
          				<!--
          				<a th:href="@{/boards}" class="btn btn-outline-success">
            				Home
          				</a>
          				<th:block th:if="${not #strings.equals(board.division, 'Í≥µÏßÄÏÇ¨Ìï≠')}">
            				<a th:href="@{/boards/{division}(division = ${enDivision})}" class="btn btn-info" style="color: white;">
              					Í≤åÏãúÌåêÍ∞ÄÍ∏∞
            				</a>
          				</th:block>
          				-->
        			</div>
      			</div>
    		</div>

    		<th:block th:if="${not #strings.equals(board.division, 'Í≥µÏßÄÏÇ¨Ìï≠')}">
      			<div id="scr">
        			<th:block th:if="${not #lists.isEmpty(commentList)}">
          				<hr>
        			</th:block>
          
        			<th:block th:if="${not #lists.isEmpty(commentList)}">
          				<h4><strong>[[${commentSize.size}]]</strong>Í∞úÏùò ÎåìÍ∏Ä</h4>
          				<br>
        			</th:block>
      			</div>
          
      			<!-- ÎåìÍ∏Ä -->
      			<ul class="list-group list-group-flush" th:each="comm : ${commentList}" th:id="${comm.id}">
        			<li class="list-group-item">
          				<div>
            				<form th:action="@{/comments/{id}(id = ${comm.id})}" class="w-100" method="post">
              					<input type="hidden" th:field="${board.division}"></input>
              					<input type="hidden" name="boardId" th:value="${board.id}"></input>
              					<th:block th:if="${comm.deleteTime == null}">														
                					<p>
                  						<b>‚óΩ&nbsp;[[ ${comm.userNickName} ]]</b> / 
                  						<th:block th:if="${comm.modifyTime == null}">
                    						[[ ${comm.createTime} ]]	
                  						</th:block>
                  						<th:block th:if="${comm.modifyTime != null}">
                  							[[ ${comm.modifyTime} ]](ÏàòÏ†ï)
                  						</th:block>
                  						<button class="btn btn-link btn-sm" type="button" data-bs-toggle="collapse" th:attr="data-bs-target=|#a${comm.id}">ÎãµÍ∏ÄÏì∞Í∏∞</button>
                					</p>				
                					<div>
                  						<div class="card-text" th:utext="${@commonmarkUtil.markdown(comm.contents)}"></div>							
                					</div>
              					</th:block>
              					<th:block th:if="${comm.deleteTime != null}">														
                					<p>
                  						<s>ÏÇ≠Ï†ú Îêú ÎåìÍ∏ÄÏûÖÎãàÎã§.</s>
                					</p>				
              					</th:block>
              					<div class="collapse mb-2" th:id="a + ${comm.id}">
                					<div class="input-group mb-3">
                  						<textarea rows="5" cols="50" name="replyContents" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."></textarea>
                  						<button type="submit" class="btn btn-outline-success btn-sm" name="action" value="replyCreate">ÎãµÍ∏ÄÏì∞Í∏∞</button>
                					</div>
              					</div>
              					<div class="collapse mb-2" th:id="c + ${comm.id}">
                					<div class="input-group mb-3">
                  						<textarea rows="5" cols="50" name="contents" placeholder="ÏàòÏ†ï Ìï† ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."></textarea>
                  						<button type="submit" class="btn btn-outline-success btn-sm" name="action" value="modify">ÏàòÏ†ïÏôÑÎ£å</button>
                					</div>
              					</div>
              					<th:block th:if="${session.user != null}">
                					<th:block th:if="${#strings.equals(session.user.nickName, comm.userNickName)} and ${comm.deleteTime == null}">
                  						<p>						
                    						<button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" th:attr="data-bs-target=|#c${comm.id}">ÏàòÏ†ï</button> 
                    						/ 
                    						<button class="btn btn-outline-warning" type="submit" name="action" value="delete">ÏÇ≠Ï†ú</button>
                  						</p>
                					</th:block>
              					</th:block>
            				</form>
          				</div>
        			</li>

        			<!-- ÎåÄÎåìÍ∏Ä -->
        			<th:block th:each="rep : ${replyList}">
         	 			<th:block th:if="${rep.groupId == comm.id}">
            				<input type="hidden" name="replyId" th:value="${rep.id}"></input>
            				<ul class="list-group list-group-flush">
              					<li class="list-group-item">
                					<div>
                  						<form th:action="@{/comments/{id}(id = ${rep.id})}" method="post">
                    						<input type="hidden" th:field="${board.division}"></input>
                    						<input type="hidden" name="boardId" th:value="${board.id}"></input>
                    						<th:block th:if="${rep.deleteTime == null}">		
                      							<p>
                        							<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚§∑&nbsp;&nbsp;[[ ${rep.userNickName} ]]</b> / 
                        							<th:block th:if="${rep.modifyTime == null}">
                          								[[ ${rep.createTime} ]]	
                        							</th:block>
                        							<th:block th:if="${rep.modifyTime != null}">
                          								[[ ${rep.modifyTime} ]](ÏàòÏ†ï)
                        							</th:block>
                      							</p>				
                      							<div>
                      								<div class="card-text" th:utext="${@commonmarkUtil.markdown(rep.contents)}"></div>	
                        							<!--<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[ ${rep.contents} ]]</p>-->						
                      							</div>
                    						</th:block>
                    						<th:block th:if="${rep.deleteTime != null}">														
                     	 						<p>	
                        							<s>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚§∑&nbsp;&nbsp;ÏÇ≠Ï†ú Îêú ÎåìÍ∏ÄÏûÖÎãàÎã§.</s>
                      							</p>				
                    						</th:block>
                    						<div class="collapse mb-2" th:id="rc + ${rep.id}">
                      							<div class="input-group mb-3">
                        							<textarea rows="5" cols="50" name="modifyContents" placeholder="ÏàòÏ†ï Ìï† ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."></textarea>
                        							<button type="submit" class="btn btn-outline-success btn-sm" name="action" value="replyModify">ÏàòÏ†ïÏôÑÎ£å</button>
                      							</div>
                    						</div>
                    						<th:block th:if="${session.user != null}">
                      							<th:block th:if="${#strings.equals(session.user.nickName, rep.userNickName)} and ${rep.deleteTime == null}">
                        							<p>						
                          								<button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" th:attr="data-bs-target=|#rc${rep.id}">ÏàòÏ†ï</button> 
                            							/ 
                          								<button class="btn btn-outline-warning" type="submit" name="action" value="replyDelete">ÏÇ≠Ï†ú</button>
                        							</p>
                      							</th:block>
                    						</th:block>
                  						</form>
                					</div>
              					</li>
            				</ul>
          				</th:block>
        			</th:block> 
      			</ul>
  
      			<br><br>
  
      			<form th:action="@{/comments/create}" method="post">
        			<input type="hidden" th:field="${board.id}"></input>
        			<input type="hidden" th:field="${board.userNickName}"></input>
        			<input type="hidden" th:field="${board.division}"></input>
        			<div class="mb-3 mt-2">
            			<textarea class="form-control" rows="3" id="contents" name="contents" placeholder="Î∞îÎ•∏Îßê Í≥†Ïö¥Îßê"></textarea>
        			</div>
        			<div class="text-end">
          				<button type="submit" class="btn btn-primary">ÎåìÍ∏ÄÏì∞Í∏∞</button>
        			</div>    
      			</form>
				<br>
      			<hr>
    
      			<div class="container">
        			<div class="p-1 bg-default text-white rounded">
          				<div><br>
            				<table class="table table-hover">
              					<thead class="table-light">
                					<tr>
                  						<th>Î≤àÌò∏</th>
                  						<th>Ï†úÎ™©</th>
                  						<th>ÏûëÏÑ±Ïûê</th>
                  						<th>ÎÇ†Ïßú</th>
                  						<th>Ï°∞ÌöåÏàò</th>
                					</tr>
              					</thead>
              					<tbody>
                					<tr th:each="bd : ${boardList}" th:classappend="${bd.id == board.id} ? 'table-secondary' : ''">
                  						<td th:text="${bd.id}"></td>
                  						<td>
                    						<a style="text-decoration: none;" th:href="@{/boards/{division}/{id}(division = ${enDivision}, id = ${bd.id}, srt = ${srt}, page = ${pagination.criteria.page})}">
                      							[[${bd.title}]]
                    						</a>
                   	 						<th:block th:if="${bd.commentsCnt != 0}">
                      							( [[ ${bd.commentsCnt} ]] )
                    						</th:block>
                    						<th:block th:if="${bd.hits} &gt;= 100">
                      							<span class="badge rounded-pill bg-danger"><small>&nbsp;Hot</small></span>
                    						</th:block>
                  						</td>
                  						<td>
                    						<a style="text-decoration: none; color: black;" data-bs-toggle="tooltip" title="ÏûëÏÑ± Í∏Ä Î≥¥Îü¨Í∞ÄÍ∏∞" th:href="@{/boards/name/{nickName}(nickName = ${bd.userNickName})}">
                      							[[ ${bd.userNickName} ]]
                    						</a>
                  						</td>
                  						<th:block th:if="${bd.modifyTime} == null">
                    						<td th:text="${bd.createTime}"></td>
                  						</th:block>
                 						<th:block th:if="${bd.modifyTime} != null">
                    						<td>[[ ${bd.modifyTime} ]]&nbsp;<small>(ÏàòÏ†ï)</small></td>
                  						</th:block>
                  						<td th:text="${bd.hits}"></td>
                					</tr>
              					</tbody>
            				</table>
        
            				<ul class="pagination justify-content-center">			
              					<th:block th:if="${pagination.prev}">				
                					<li class="page-item">
                  						<a class="page-link" th:href="@{/boards/{division}(division = ${enDivision}, page = ${pagination.startPage} - 1)}" aria-label="Previous">
                    						<span aria-hidden="true"><<</span>
                  						</a>
                					</li>	
              					</th:block>
              					<th:block  th:with="start = ${pagination.startPage}, end = ${pagination.endPage}">
                					<li class="page-item mx-1" th:each="pageNum : ${#numbers.sequence(start, end)}" th:classappend="${pagination.criteria.page == pageNum} ? 'active' : ''">
                  						<a class="page-link" th:href="@{/boards/{division}(division = ${enDivision}, page = ${pageNum})}" th:text=${pageNum}></a>
                					</li>
              					</th:block>	
              					<th:block th:if="${pagination.next}">		
                					<li class="page-item">
                  						<a class="page-link" th:href="@{/boards/{division}(division = ${enDivision}, page = ${pagination.endPage} + 1)}" aria-label="Next">
                    						<span aria-hidden="true">>></span>
                  						</a>
                					</li>    						
              					</th:block>	
            				</ul>
          				</div>
        			</div>
      			</div>	 
    		</th:block>

  		</div>
  		<hr>
	</div>
	
	<div>
		<a style="position: fixed; bottom: 40px; right: 2%; display: none; z-index: 999; text-decoration: none;" 
			class="btn btn-success rounded-circle" id="topBtn" href="#">TOP</a>
	</div>

	<div class="modal fade" id="myM">
  		<div class="modal-dialog">
    		<div class="modal-content panel-danger">
      			<!-- Modal Header -->
      			<div id="mColor">
        			ÏïåÎ¶º Ï∞Ω
        			<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      			</div>
			    <!-- Modal body -->
			    <div class="modal-body" id="mcon">
			    	...
			    </div>
			    <!-- Modal footer -->
			    <div class="modal-footer">
			    	<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
			    </div>
    		</div>
  		</div>
	</div>

    <th:block th:replace="fragments/footer :: footer"></th:block>
    
    <script>
    	$('#summernote').summernote({
			airMode: true,
  			disableDragAndDrop: true  
		});
      	$('#summernote').summernote('disable');
      	
      	
      	$(function() {
	        $(window).scroll(function() {
	            if ($(this).scrollTop() > 500) {
	                $('#topBtn').fadeIn();
	            } else {
	                $('#topBtn').fadeOut();
	            }
	        });
	        $("#topBtn").click(function() {
	            $('html, body').animate({scrollTop : 0
	            }, 'slow');
	            return false;
	        });
    	});
    	
    	feather.replace()
    </script>

</body>
</html>